\section{Derivatives}
One of the most important tool in analyzing a function $f:\Rs\to\Rs$ is the ability to quantitatively describe the way it behaves as we change its argument $x$. At any given point a function can either increase in its value, decrease in its value, or stay constant. We would like to develop a method that is able to tell us exactly how such function changes at any given point.

\begin{example}{Quantitative measure of change}{}
  Compare the following three functions on the domain $x\in[a,b]$:

  \centering
  \begin{tikzpicture}
    \begin{axis}[
        graph2d,
        axis line style={-stealth, thick},
        xmin=1, xmax=6,
        ymin=0, ymax=20,
        domain={1:6},
        xticklabels={,,,,,,$b$},
        extra x ticks={1},
        extra x tick labels={$a$},
        extra x tick style={grid=none},
        yticklabels={},
      ]
       \addplot[function, xred] {exp(x)};
       \addplot[function, xgreen] {x^2};
       \addplot[function, xblue] {x^(1.5)};
    \end{axis}
  \end{tikzpicture}

  \flushleft
  While all three functions are increasing on $[a,b]$ it is clear that the rate of increase between the functions is different: the red function increases faster than the green one, which in turn increases faster than the blue one. In fact, even within each function the increase is not uniform: the more $x$ increases so does the rate of increase of the function.
\end{example}

To start developing a method to quantitatively measure the rate of change in a real function, we can first notice a property of some functions: if we zoom in on some point of the function $\bm{p}=\left(a,f\left(a\right)\right)$ we would see that the more we zoom in the more the the function behaves like a straight line around $\bm{p}$ (\autoref{fig:zoom_in}). We can define the limit of this zoom (i.e. when the zoom factor goes to infinity) as the slope of the function at the $\bm{p}$.

\tikzset{
  bslope/.style={very thick, dashed, #1},
}
\begin{figure}
  \centering
  \begin{tikzpicture}
    \pgfmathsetmacro{\zo}{1}
    \pgfmathsetmacro{\za}{0.02}
    \pgfmathsetmacro{\zb}{0.1}
    \pgfmathsetmacro{\a}{3.75}
    \pgfmathsetmacro{\b}{3.1}
    \pgfmathsetmacro{\R}{0.03}
    \pgfmathsetmacro{\ma}{DzoomG(\a)}
    \pgfmathsetmacro{\mb}{DzoomG(\b)}
    \begin{axis}[
      zoomin={\a}{\zo},
      width=11cm, height=11cm,
      axis x line=middle,
      axis y line=middle,
      every axis x label/.style={
        at={(ticklabel* cs:1.01)},
        anchor=west,
      },
      every axis y label/.style={
        at={(ticklabel* cs:1.01)},
        anchor=south,
      },
      axis line style={-stealth, thick},
      label style={font=\large},
      xlabel=$x$,
      ylabel=$y$,
      name=ax1,
      ]
      \addplot[only marks, mark=*] coordinates {
          (\a,{zoomF(\a,\a)})
          (\b,{zoomF(\b,\a)})
        };
      \addplot[function, xred] {zoomF(x,\a)};
      % Point a
      \coordinate (ca1) at ({\a-\za},{\a-\za});
      \coordinate (ca2) at ({\a-\za},{\a+\za});
      \coordinate (ca3) at ({\a+\za},{\a+\za});
      \coordinate (ca4) at ({\a+\za},{\a-\za});
      \draw (ca1) rectangle (ca3);
      % Point b
      \coordinate (cb1) at ({\b-\zb},{zoomF(\b,\a)-\zb});
      \coordinate (cb2) at ({\b-\zb},{zoomF(\b,\a)+\zb});
      \coordinate (cb3) at ({\b+\zb},{zoomF(\b,\a)+\zb});
      \coordinate (cb4) at ({\b+\zb},{zoomF(\b,\a)-\zb});
      \draw (cb1) rectangle (cb3);
    \end{axis}
    \begin{axis}[
      zoomin={\a}{\za},
      name=zoom_a,
      at={($(ax1.south east)+(-6cm,7cm)$)},
      ]
      \coordinate (a) at (\a, {zoomF(\a,\a)});
      % \draw[bslope={xblue}] (\a,\a) -- ({\a+\za},{\a+\za*\ma});
      % \draw[bslope={xblue}] (\a,\a) -- ({\a-\za},{\a-\za*\ma});
      \addplot[function, xred] {zoomF(x,\a)};
      \addplot[only marks, mark=*] coordinates {
          (\a,\a)
        };
      \node[above right of=a, yshift=-3pt] (atxt) {$\bm{p}_{a}=\left(a,f(a)\right)$};
    \end{axis}
    \begin{axis}[
      zoomin={\b}{\zb},
      name=zoom_b,
      at={($(ax1.south east)+(-7cm,-7cm)$)},
      ]
      \addplot[only marks, mark=*] coordinates {
          (\b,\b)
        };
      \coordinate (b) at (\b, {zoomF(\b,\b)});
      \draw[bslope={xdarkgreen}] (\b,\b) -- ({\b+\zb},{\b+\zb*\mb});
      \draw[bslope={xdarkgreen}] (\b,\b) -- ({\b-\zb},{\b-\zb*\mb});
      \addplot[function, xred] {zoomF(x,\b)};
      \fill (\b,\b) circle ({\R*\zb});
      \node[right of=b, anchor=west, xshift=-20pt] (btxt) {$\bm{p}_{b}=\left(b,f(b)\right)$};
    \end{axis}
    % To a
    \draw[dashed] (ca2) -- (zoom_a.south west);
    \draw[dashed] (ca3) -- (zoom_a.south east);
    \draw[dashed] (cb1) -- (zoom_b.north west);
    \draw[dashed] (cb4) -- (zoom_b.north east);
  \end{tikzpicture}
  \caption{Zooming in on a real function $f$ at two points: $\bm{p}_{a}=\left(a,f(a)\right)$ (upper right) and $\bm{p}_{b}=\left(b,f(b)\right)$ (bottom right). Note how around each of the points, the function looks somewhat linear: this is more pronounced around $\bm{p}_{b}$ where the function looks linear in the entire zoomed-in area, while near $\bm{p}_{a}$ it looks linear only near the point itself even though the zoom factor is higher.}
  \label{fig:zoom_in}
\end{figure}

How can we quantify this idea? Let us consider some real function $f$ and a point $\bm{p}_{0} = \left(x_{0},f\left(x_{0}\right)\right)$ on the function. We can then define another point to the right of $x_{0}$: $\bm{p}_{1}=\left(x_{1},f\left(x_{1}\right)\right)$. Since $x_{1}$ is to the right of $x_{0}$ we can write it as $x_{1}=x_{0}+\Delta x$, where $\Delta x>0$. We then connect the two points with a line (\autoref{fig:x0_x1_line}). The slope of this line can then be calculated using \autoref{eq:linear_slope_def}:
\begin{equation}
  m = \frac{\Delta y}{\Delta x} = \frac{f\left(x_{1}\right)-f\left(x_{0}\right)}{x_{1}-x_{0}} = \frac{f\left(x_{0}+\Delta x\right)-f\left(x_{0}\right)}{x_{0}+\Delta x - x_{0}} = \frac{f\left(x_{0}+\Delta x\right)-f\left(x_{0}\right)}{\Delta x}.
  \label{eq:derivative_slope_def}
\end{equation}

\begin{figure}
  \centering
  \begin{tikzpicture}[node distance=13pt]
    \pgfmathsetmacro{\R}{3}
    \pgfmathsetmacro{\c}{1.5}
    \pgfmathsetmacro{\xa}{1.5}
    \pgfmathsetmacro{\xb}{3.5}
    \begin{axis}[
      graph2d,
      width=9cm, height=9cm,
      xmin=0, xmax=4,
      ymin=0, ymax=4,
      xticklabels={,},
      yticklabels={,},
      grid=major,
      major grid style={draw=black!2},
      extra x tick style={
        tick label style={xblue},
        major grid style=black!0,
      },
      extra x ticks={\xa, \xb},
      extra x tick labels={$x_{0}$, $x_{1}$},
      extra y tick style={
        tick label style={xblue},
        major grid style=black!0,
      },
      extra y ticks={{fd(\xa)}, {fd(\xb)}},
      extra y tick labels={$f\left(x_{0}\right)$, $f\left(x_{1}\right)$},
      axis line style={-stealth},
      domain={0:4},
      samples=100,
      declare function={
        fd(\x)=sqrt(\R^2-(\x-\c)^2)-1;
        Dfd(\x)=-(\x-\c)/sqrt(\R^2-(\x-\c)^2);
      },
    ]
    % Coordinate lines lines
    \tikzset{prp/.style={perp, black!20}}
    \draw[prp] (\xa,0) -- (\xa,{fd(\xa});
    \draw[prp] (\xb,0) -- (\xb,{fd(\xb});
    \draw[prp] (0,{fd(\xa)}) -- (\xa,{fd(\xa});
    \draw[prp] (0,{fd(\xb)}) -- (\xb,{fd(\xb});
    % Derivative slope at x=\c
    \pgfmathsetmacro{\m}{(fd(\xb)-fd(\xa))/(\xb-\xa)}
    % Line between points and its slope
    \draw[xred, very thick] (\xa, {fd(\xa)}) -- (\xb,{fd(\xb)});
    % \addplot[function, xred, dashed] {\m*(x-\xa)+fd(\xa)};
    % % Derivatie at x0
    % \pgfmathsetmacro{\M}{Dfd(\xa)}
    % \addplot[function, xgreen, dashed] {\M*(x-\xa)+fd(\xa)};
    % Function + points on it
    \addplot[function, xblue] {fd(x)};
    \addplot[only marks, mark=*] coordinates {
        (\xa,{fd(\xa)})
        (\xb,{fd(\xb)})
      };
    % Labels
    \coordinate (p0) at (\xa,{fd(\xa)});
    \coordinate (p1) at (\xb,{fd(\xb)});
    \node[above of=p0] (p0lbl) {$\bm{p}_{0}$};
    \node[above of=p1] (p1lbl) {$\bm{p}_{1}$};
    \end{axis}
  \end{tikzpicture}
  \caption{Text.}
  \label{fig:x0_x1_line}
\end{figure}

We can then take the limit of \autoref{eq:derivative_slope_def} as $\Delta x\to 0$ (\autoref{fig:derivate_limit}):
\begin{equation}
  M = \lim\limits_{\Delta x\to 0} \frac{f\left(x_{0}+\Delta x\right)-f\left(x_{0}\right)}{\Delta x}.
  \label{eq:derivative_def}
\end{equation}
This limit is defined as \emph{the derivative} of $f$ at the point $x=x_{0}$, and it tells us, quantitatively, how $f$ locally behaves at $x_{0}$, i.e. how much does it increase, decrease or stay the same around $x_{0}$.

\newcommand{\derivFig}[1]{
  \begin{tikzpicture}
    \pgfmathsetmacro{\R}{3}
    \pgfmathsetmacro{\c}{1.5}
    \pgfmathsetmacro{\xa}{1.5}
    \pgfmathsetmacro{\xb}{\xa+#1}
    \begin{axis}[
      graph2d,
      width=6cm, height=6cm,
      xmin=0, xmax=4,
      ymin=0, ymax=4,
      xticklabels={,},
      yticklabels={,},
      grid=major,
      major grid style={draw=black!2},
      axis line style={-stealth},
      domain={0:4},
      samples=40,
      declare function={
        fd(\x)=sqrt(\R^2-(\x-\c)^2)-1;
        Dfd(\x)=-(\x-\c)/sqrt(\R^2-(\x-\c)^2);
      },
    ]
    % Derivative slope at x=\c
    \pgfmathsetmacro{\m}{(fd(\xb)-fd(\xa))/(\xb-\xa)}
    % Line between points and its slope
    % \draw[xred, very thick] (\xa, {fd(\xa)}) -- (\xb,{fd(\xb)});
    \addplot[function, xred] {\m*(x-\xa)+fd(\xa)};
    % Derivatie at x0
    \pgfmathsetmacro{\M}{Dfd(\xa)}
    \addplot[function, xgreen] {\M*(x-\xa)+fd(\xa)};
    % Function + points on it
    \addplot[function, xblue] {fd(x)};
    \addplot[only marks, mark=*] coordinates {
        (\xa,{fd(\xa)})
        (\xb,{fd(\xb)})
      };
    % Labels
    \end{axis}
  \end{tikzpicture}
}

\begin{figure}
  \centering
  \begin{subfigure}[b]{0.45\textwidth}
    \centering
    \derivFig{2.5}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \centering
    \derivFig{2.2}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \centering
    \derivFig{2}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \centering
    \derivFig{1.2}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \centering
    \derivFig{0.3}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.45\textwidth}
    \centering
    \derivFig{0.1}
  \end{subfigure}
  \hfill
  \caption{Test.}
  \label{fig:derivate_limit}
\end{figure}

